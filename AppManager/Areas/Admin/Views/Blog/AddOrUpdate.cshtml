@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Dashboard";
    string error = TempData["error"] as string;
}

<section class="content-header">
    <h1>
        &nbsp;
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Blog</a></li>
        <li class="active">Quản lý bài viết</li>
    </ol>
</section>

<section class="content">
    <div class="row">
    <div class="col-md-3">
        <div class="box box-primary">
            <div class="box-body box-profile" id="author-info">
                
            </div>
        </div>
    </div>
    <!-- /.col -->
    <div class="col-md-9">
        <div class="box box-primary">
            <form >
                <div class="box-header with-border">
                    <h3 class="box-title">Quản lý bài viết</h3>
                </div>
                <div class="box-body">
                        <input type="text" name="id" value="@(Model == null ? 0 : @Model.Id)" hidden />
                        <input type="text" name="postAvatarId" id="image-file-id" value="@(Model == null ? 0 : @Model.PostAvatarId)" hidden />
                        <input type="text" name="postAvatarFilePath" id="image-file-path" value="@(Model == null ? "" : @Model.PostAvatarFilePath)" hidden />
                        <div class="form-group">
                            <input class="form-control" placeholder="Tiêu đề:" value="@(Model == null ? "" : Model.Title)" name="title">
                        </div>
                        <div class="form-group">
                            <input class="form-control" placeholder="Description:" value="@(Model == null ? "" : Model.Description)" name="description">
                        </div>
                        <div class="form-group">
                            <textarea id="txt-content" class="form-control" style="height: 300px" name="content">
                            </textarea>
                        </div>
                        <div class="form-group">
                              <label for="exampleInputFile">Ảnh đại diện</label>
                              <input type="file" id="image-upload" name="fileUpload">
                              <p class="help-block">Chọn ảnh đại diện cho bài viết</p>
                        </div>
                </div>
                <!-- /.box-body -->
                <div class="box-footer">
                    <div class="pull-right">
                        <button type="button" class="btn btn-default btnsubmit" name="save"><i class="fa fa-pencil"></i> Lưu bản nháp</button>
                        <button type="submit" class="btn btn-primary btnsubmit" name="submit"><i class="fa fa-envelope-o"></i> Gửi đi</button>
                    </div>
                    <button type="reset" class="btn btn-default btnsubmit" name="delete"><i class="fa fa-times"></i> Huỷ</button>
                </div>
            </form>
        <!-- /.box-footer -->
        </div>
        <!-- /. box -->
    </div>
    <!-- /.col -->
    </div>
    <!-- /.row -->
</section>

@section Scripts{
    <script>
        $(document).ready(function (){
            CKEDITOR.replace('txt-content', {
                customConfig: '/admin/plugins/ckeditor/config.js',
            });
        });

        $(document).ready(function (){
            $(document).on('click', '.btnsubmit', function() {
                btn = $(this).attr('name');
                console.log(btn);
            })
        });

        $(document).on('change', 'input[name="fileUpload"]', function() {
            let files = $(this).prop("files");
            let formData = new FormData();
            formData.append("file", files[0]);
            $.ajax({
                url: "/admin/blog/uploadfile",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                beforeSend: () => {

                },
                success: res => {
                    console.log(res);
                    $('#image-upload').attr('src', res.fileInfo.filePath);
                    $('#image-file-path').val(res.fileInfo.filePath);
                    $('#image-file-id').val(res.fileInfo.id);
                },
                error: error => {
                    console.log(error);
                }
            })
        });

         $.ajax({
            url: "/Admin/Blog/AuthorInfo",
            type: "GET",
            dataType: "json",
            beforeSend: function(){},
            success: function(data){
                $('#author-info').html('');
                let html = `<img class="profile-user-img img-responsive img-circle" src="${data.avatar}" alt="User profile picture">
                            <h3 class="profile-username text-center">${data.authorName}</h3>
                            <p class="text-muted text-center">${data.authorRole}</p>`
                $('#author-info').append(html);                
            },
            error: function(){},
            complete: function(){}
        });
    </script>
}